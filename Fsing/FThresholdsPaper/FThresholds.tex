\documentclass{amsart}
\usepackage{calc,amssymb,amsthm,amsmath,setspace}
\RequirePackage[dvipsnames,usenames]{xcolor}

\usepackage{fancyvrb}
\usepackage{hyperref}
\hypersetup{
bookmarks,
bookmarksdepth=3,
bookmarksopen,
bookmarksnumbered,
pdfstartview=FitH,
colorlinks,backref,hyperindex,
linkcolor=Sepia,
anchorcolor=BurntOrange,
citecolor=MidnightBlue,
citecolor=OliveGreen,
filecolor=BlueViolet,
menucolor=Yellow,
urlcolor=OliveGreen
}
\usepackage{xspace}
%\usepackage{rotating}
\interfootnotelinepenalty=100000

\usepackage{mabliautoref}
\usepackage{colonequals}
\frenchspacing
\input{kmacros3.sty}

\usepackage{verbatim}
\usepackage{enumerate}
\usepackage[normalem]{ulem}
%\usepackage{marginnote}
\newcommand{\fram}{\mathfrak{m}}
\DefineVerbatimEnvironment%
{MyVerbatim}{Verbatim}
{formatcom=\color{Violet}}

\newenvironment{nouppercase}{%
\let\uppercase\relax%
\renewcommand{\uppercasenonmath}[1]{}}{}

\newcommand{\ft}{\operatorname{c}}
\newcommand{\idealm}{\mathfrak{m}}


\begin{document}
\title{The \emph{FrobeniusThresholds} package for \emph{Macaulay2}}

\author[]{Daniel J.\ Hern\'andez}
\address{Department of Mathematics, University of Kansas, Lawrence, KS~66045, USA}
\email{hernandez@ku.edu}
\thanks{D.~J.~Hern\'andez was partially supported by NSF DMS \#1600702.}

%\author[]{Sara Malec}
%\address{Department of Mathematics, Hood College, Frederick, MD 21701}
%\email{malec@hood.edu}

%\author[]{Marcus Robinson}
%\address{Department of Mathematics, University of Utah, Salt Lake City, UT~84112, USA}
%\email{robinson@math.utah.edu}

\author[]{Karl Schwede}
\address{Department of Mathematics, University of Utah, Salt Lake City, UT~84112, USA}
\thanks{K.~Schwede was supported by NSF CAREER Grant DMS \#1252860/1501102, NSF FRG Grant DMS \#1265261/1501115, NSF grant \#1801849 and a Sloan Fellowship.}
\email{schwede@math.utah.edu}

\author[]{Pedro Teixeira}
\address{Department of Mathematics, Knox College, Galesburg, IL~61401, USA}
\email{pteixeir@knox.edu}

\author[]{Emily E.\ Witt}
\address{Department of Mathematics, University of Kansas, Lawrence, KS~66045, USA}
\email{witt@ku.edu}
\thanks{E.~E.~Witt was partially supported by NSF DMS \#1623035.}
\date{\today}

\begin{abstract}
   This note describes the \emph{Macaulay2} package \emph{FrobeniusThresholds}.
   This package is designed to estimate and calculate $F$-pure thresholds, more general $F$-thresholds, and related numerical invariants arising in the study of singularities in prime characteristic commutative algebra.
\end{abstract}

\subjclass[2010]{13A35}

\keywords{Macaulay2, Frobenius, $F$-singularity, $F$-pure threshold, $F$-threshold}

\begin{nouppercase}
\maketitle
\end{nouppercase}

\section{Introduction}

This paper describes the \emph{Macaulay2} \cite{M2} package \emph{FrobeniusThresholds}, which provides tools for computing certain fundamental invariants arising in positive characteristic commutative algebra.  More precisely, this package concerns the effective computation of \emph{$F$-pure thresholds}, \emph{$F$-thresholds}, and \emph{$F$-jumping exponents}.

Recall that a ring of prime characteristic $p>0$ is said to be \emph{$F$-pure} if the Frobenius map|that is, the ring endomorphism sending an element to its $p$-th power|is a pure morphism;  under natural geometric hypotheses, this is equivalent to the condition that the Frobenius morphism splits as a map of rings.

The concept of $F$-purity has proven to be important in commutative algebra, and has a rich history.  Indeed, it first appeared in the work \cite{HochsterRobertsFrobeniusLocalCohomology}  of Hochster and Roberts to study local cohomology \cite{HochsterRobertsFrobeniusLocalCohomology}, was compared with rational singularities in  \cite{FedderFPureRat}, and was used to study global properties of Schubert varieties in \cite{MehtaRamanathanFrobeniusSplittingAndCohomologyVanishing}.

After the advent of tight closure \cite{HochsterHunekeTC1}, the usage of Frobenius to quantify singularity|that is, deviation from regularity|proliferated, and based on a connection discovered between $F$-pure and \emph{log canonical} singularities \cite{HaraWatanabeFRegFPure}, the concept of $F$-purity was generalized to the context of \emph{pairs}.
% $(R, f^t)$, where $f$ is an element of $R$, and $t$ is a nonnegative real number considered a formal exponent.

Along these lines, the \emph{$F$-pure threshold} %associated to an element of $R$ 
was defined in analogy with the \emph{log canonical threshold} \cite{TakagiWatanabeFPureThresh}, and     
%The $F$-pure threshold of the pair $(R, f)$ is the supremum over all $t$ for which $(R, f^t)$ is $F$-pure.  
\emph{$F$-threholds} were then introduced as a family of invariants that naturally extend the notion of an $F$-pure threshold \cite{MustataTakagiWatanabeFThresholdsAndBernsteinSato}. 

Unfortunately, the $F$-pure threshold is typically difficult to calculate, even in many concrete cases.   It is also not so well understood from the perspective of reduction to prime characteristic.   Nevertheless, $F$-pure thresholds have been the focus of intense study over the past fifteen years, and the \emph{Macaulay2} package \emph{FrobeniusThresholds} is centered around calculating and estimating the $F$-pure threshold and other $F$-thresholds, with the function {\tt fpt} at its core. 

\subsection*{Some background and notation}  For most of this article, we work in a polynomial ring over a finite field of  characteristic $p>0$.  Unless otherwise stated, all polynomials and ideals under consideration are regarded as elements in this ambient ring.  The ideal of this ring generated by the ring's variables is denoted $\idealm$.

Let us roughly outline how many natural numerical invariants in prime characteristic commutative algebra are constructed:  For every natural number $e$, associate to some fixed set of data|often, a collection of polynomials and ideals|an integer describing something of relevance that depends on $e$ (e.g., the dimension of some interesting vector space constructed in terms of your initial data).   Finally, normalize this integer by dividing by some power of $p^e$, and then take the limit as $e \to \infty$.

Consider a nonzero polynomial $f$ and a natural number $e$.  If $f$ does not vanish at the origin, then set set $\nu_f^{\idealm}(p^e) := \infty$.  Otherwise, $f \in \idealm$, and we instead define
\[ \nu_f^{\idealm}(p^e) := \max \{ n>0 : f^n \notin \idealm^{[p^e]} \} \] 
where $\idealm^{[p^e]}$ denotes the $p^e$-th Frobenius power of $\idealm$, that is, the ideal generated by the $p^e$-th powers of the elements of $\idealm$.    It is not very hard to see that this number is exactly the largest power of $f$ that is part of a free basis for the localization of the ambient polynomial ring at the origin over its subring of $p^e$-th powers.  As noted earlier, this number also has a natural interpretation in terms of $F$-purity of pairs.   

Following our outline, we define 
\[ \ft^{\idealm}(f) := \lim_{e \to \infty} \frac{ \nu_f^{\idealm}(p^e)}{p^e} \]

Inspired by its connections with the $F$-purity of pairs,  this limit is called the \emph{$F$-pure threshold} of $f$ at the origin.  This limit exists, and is finite when $f \in \idealm$.  In the latter case, the limit is also rational, but this is far from obvious  \cite{BlickleMustataSmithDiscretenessAndRationalityOfFThresholds}.

The $F$-pure threshold is closely related to many other fundamental concepts in prime characteristic commutative algebra.   For instance, 
\[ \ft^{\idealm}(f) = \inf \{ t>0 : \tau(f^t)  \subseteq \idealm \} = \sup \{ t>0 : \sigma( f^t) \neq 0 \} \]
where $\tau(f^t)$ and $\sigma(f^t)$ are the \emph{test ideal} and \emph{$F$-signature}, respectively, associated to $f$ and the formal nonnegative real exponent $t$.  The former is an ideal in the ambient ring of $f$, and the latter is a real number;  both depend on the parameter $t$ and prime $p$ in subtle ways \cite{BlickleMustataSmithDiscretenessAndRationalityOfFThresholds, BlickleSchwedeTuckerFSigPairs1}.
Though we will not elaborate much on these topics,  we stress that the \emph{Macaulay2} package \emph{TestIdeals} provides functionality for the effective computation of test ideals in many cases \cite{TestIdealsPackage, TestIdealsPaper}. 

In the literature, the $F$-pure threshold $\ft^{\idealm}(f)$ is often denoted $\fpt(f)$, for obvious reasons.  However, in this note, we adopt the former notation to avoid any possible confusion with the \emph{Macaulay2} function {\tt fpt} described in Section \ref{sec.FPT}.  Indeed, the command {\tt fpt(f)} need not always output the number $\ft^{\idealm}(f) = \fpt(f)$, though in the case that it cannot, it will provide a reasonably good estimate of this number.

It turns out that the sequence $\{ \nu_f^{\idealm}(p^e) \}_{e=1}^{\infty}$ itself, and not just its limit, also encodes interesting information about $f$.  For example, it is closely related to the so-called \emph{Bernstein-Sato polynomial} \cite{MustataTakagiWatanabeFThresholdsAndBernsteinSato}.  Thus, it is natural to ask whether one can recover the sequence $\{ \nu_f^{\idealm}(p^e) \}_{e=1}^{\infty}$ from the limit $\ft^{\idealm}(f)$.  Fortunately, the answer to this question is yes \cite{MustataTakagiWatanabeFThresholdsAndBernsteinSato, HernandezFPurityOfHypersurfaces}. More precisely, 
\begin{equation}
\label{sequence-from-limit}
\nu_f^{\idealm}(p^e) = \lceil p^e \cdot \ft^{\idealm}(f) \rceil - 1.  
\end{equation}  

We conclude this subsection by briefly reviewing some natural generalizations.  Suppose that $I$ and $J$ are ideals.  If $I$ is contained in the radical of $J$, then we set
%
\[ \nu_I^J(p^e) = \max \{ n : I^n \notin J^{[p^e]} \}. \]  
Otherwise, we set $\nu_I^J(p^e) = \infty$.  

This clearly generalizes the quantity $\nu_f^{\idealm}(p^e)$ considered earlier, and we call 
\[ \ft^J(I) := \lim_{e \to \infty} \frac{ \nu_f^{\idealm}(p^e)}{p^e} \]
the \emph{$F$-threshold of $I$ with respect to $J$}.  These numbers are also rational, when finite, and we call the quantity $\ft^{\idealm}(I)$ the $F$-pure threshold of the ideal $I$.  Like $F$-pure thresholds, the $F$-thresholds of $I$ can also be defined in terms of its test ideals.

\subsection*{Organization}

There are three main sections in this paper, which describe and illustrate the main functionality implemented in the package \emph{FrobeniusThresholds}.
\begin{itemize}
\item \autoref{sec.Nu} describes the methods implemented for approximating the $F$-pure threshold and other $F$-thresholds.  
\item \autoref{sec.IsFPT} explains the package's functionality for determining whether a given number is the $F$-pure threshold, or more generally, an \emph{$F$-jumping exponent}.
\item \autoref{sec.FPT} describes the features of the central function of the package, {\tt fpt}. 
\end{itemize}

This package builds heavily upon the \emph{TestIdeals} package for \emph{Macaulay2}, which provides a broad range of functionality in prime characteristic commutative algebra. 

\subsection*{Acknowledgements.}  First and foremost, the authors enthusiastically thank all authors and contributors to the \emph{FrobeniusThresholds} package.
Our package coauthors are (LIST NAMES), and others who contributed code are (LIST OTHER NAMES). %Erin Bela, Juliette Bruce, Zhibek Kadyrsizova, Sara Malec, Maral Mostafazadehfard, Marcus Robinson, Dan Smolkin, and Robert Walker. 
We are also grateful the organizers of the \emph{Macaulay2} workshops where much of the functionality described herein was developed, hosted by Wake Forest University in 2012, the University of California, Berkeley in 2014 and 2017, Boise State University in 2015, and the University of Utah in 2016. 
We are also grateful to the University of Utah for hosting a collaborative development visit in 2018, and to the Institute of Mathematics and its Applications for its support for the Coding Sprint \emph{F-thresholds in Macaulay2} in 2019, where the current version of the package was finalized and this paper was completed. 

\newpage

\section{The {\tt nu} function}
\label{sec.Nu}

{\color{red} This section will need to be modified so that it is consistent with the introduction section.  The point is that a lot of the notation repeated here was introduced earlier there.}

We now consider the {\tt nu} function, which is fundamental.   As in the introduction, we work in a polynomial ring over a finite field of characteristic $p>0$.


Fix a natural number $e$.  If $f$ is polynomial contained in the radical of an ideal $J$, then the command {\tt nu(e,f,J)} outputs $\nu_f^J(p^e)$, the maximal integer exponent such that $f^n$ is not contained in $J^{[p^e]}$.  More generally, if $I$ is an ideal contained in the radical of $J$, then {\tt nu(e,I,J)} outputs $\nu_I^J(p^e)$, the maximal integer exponent $n$ such that $I^n$ is not contained in $J^{[p^e]}$.

{\small
\setstretch{.67}
\begin{MyVerbatim}

i1 : R = ZZ/11[x,y];

i2 : I = ideal(x^2 + y^3, x*y);

o2 : Ideal of R

i3 : J = ideal(x^2, y^3);

o3 : Ideal of R

i4 : nu(1, I, J)

o4 = 24

i5 : f = x*y*(x^2 + y^2);

i6 : nu(1, f, J)

o6 = 10
\end{MyVerbatim}
}

%R = ZZ/11[x,y];
%I = ideal(x^2 + y^3, x*y);
%J = ideal(x^2, y^3);
%nu(1, I, J)
%f = x*y*(x^2 + y^2);
%nu(1, f, J)

We highlight some degenerate cases:  If $f$ is zero, then the output of {\tt nu(e,f,J)} is {\tt 0}, and if $f$ is not contained in the radical of $J$, then the output is instead {\tt infinity}.  These degenerate cases extend analogously to {\tt nu(e,I,J)} when $I$ is an ideal.

{\small
\setstretch{.67}
\begin{MyVerbatim}

i7 : nu(1, 0_R, J)

o7 = 0

i8 : nu(1, 1_R, J)

o8 = infinity

o8 : InfiniteNumber
\end{MyVerbatim}
}

%nu(1, 0_R, J)
%nu(1, 1_R, J)

It is possible to omit the third argument from the function {\tt nu};  in this case, the function assumes that the omitted third argument is the maximal generated by the variables in the ambient polynomial ring.

{\small
\setstretch{.67}
\begin{MyVerbatim}

i9 : R = ZZ/17[x,y,z];

i10 : f = x^3 + y^4 + z^5;

i11 : M = ideal(x, y, z);

o11 : Ideal of R

i12 : nu(2, f) == nu(2, f, M)

o12 = true
\end{MyVerbatim}
}

%R = ZZ/17[x,y,z];
%f = x^3 + y^4 + z^5;
%M = ideal(x, y, z);
%nu(2, f) == nu(2, f, M)

It is well-known that if $q=p^e$ for some nonnegative integer $e$, then \[ \nu_I^J(qp) = \nu_I^J(q)\cdot p + L\]  where the error term $L$ is nonnegative, and can be explicitly bounded from above in terms of $p$ and the number of generators of $I$ and $J$.  For instance, the error term $L$ is at most $p-1$ when $I$ is principal and $J$ is arbitrary.

This implies that when searching for the maximal exponent defining {\tt nu(e,I,J)} when $e$ is positive, it is always safe to start at $p$ times the output of {\tt nu(e-1,I,J)}, and one needn't search too far past this number.  This also suggests that the most efficient way to compute {\tt nu(e,I,J)} is to compute, successively, {\tt nu(s,I,J)}, for each {\tt s = 0,\ldots,e}.  This is indeed how the computation is done in most cases.

{\color{red} Make this consistent with the introduction.  The point is that we have already described how to get the {\tt nu}-s from their limit.  Maybe we should directly cite }.  
If $M$ is the homogeneous maximal ideal of $R$ and $f$ is an element of $R$, the numbers $\nu_f^M(p^e)$ determine and are determined by the $F$-pure threshold of $f$ at the origin.  Indeed, $\nu_f^M(p^e)$ is $p^e$ times the truncation of the non-terminating base $p$ expansion of fpt($f$) at its $e^{\textrm{th}}$ spot.  This fact is used to speed up the computations for certain polynomials whose $F$-pure thresholds can be quickly computed via special algorithms, namely diagonal polynomials and binomials.  This feature can be disabled by setting the option {\tt UseSpecialAlgorithms} (default value {\tt true}) to {\tt false}.

%R = ZZ/17[x,y,z];
%f = x^3 + y^4 + z^5; -- a diagonal polynomial
%time nu(3, f)
%time nu(3, f, UseSpecialAlgorithms => false)

The valid values for the option {\tt ContainmentTest} are {\tt FrobeniusPower}, {\tt FrobeniusRoot}, and {\tt StandardPower}. The default value of this option depends on what is passed to {\tt nu}. Indeed, by default, {\tt ContainmentTest} is set to {\tt FrobeniusRoot} if {\tt nu} is passed a ring element $f$, and is set to {\tt StandardPower} if {\tt nu} is passed an ideal $I$.  We describe the consequences of setting {\tt ContainmentTest} to each of these values below.

First, if {\tt ContainmentTest} is set to {\tt StandardPower}, then the ideal containments checked when computing {\tt nu(e,I,J)} are verified directly.  That is, the standard power $I^n$ is first computed, and a check is then run to see if it lies in the $p^e$-th Frobenius power of $J$.

Alternately, if {\tt ContainmentTest} is set to {\tt FrobeniusRoot}, then the ideal containments are verified using Frobenius Roots.  That is, the $p^e$-th Frobenius root of $I^n$ is first computed, and a check is then run to see if it lies in $J$.  The output is unaffected, but this option often speeds up computations, specially when a polynomial or principal ideal is passed as the second argument.

%R = ZZ/11[x,y,z];
%f = x^3 + y^3 + z^3 + x*y*z;
%time nu(3, f) -- ContainmentTest is set to FrobeniusRoot, by default
%time nu(3, f, ContainmentTest => StandardPower)

Finally, when {\tt ContainmentTest} is set to {\tt FrobeniusPower}, then instead of producing the invariant $\nu_I^J(p^e)$ as defined above, {\tt nu(e,I,J,ContainmentTest=>FrobeniusPower)} instead outputs the maximal integer $n$ such that the $n^{\textrm{th}}$ (generalized) Frobenius power of $I$ is not contained in the $p^e$-th Frobenius power of $J$.

Here, the $n^{\textrm{th}}$ Frobenius power of $I$, when $n$ is a nonnegative integer, is as defined in the paper {\it Frobenius Powers} by Hernández, Teixeira, and Witt.
In particular, {\tt nu(e,I,J)} and {\tt nu(e,I,J,ContainmentTest=>FrobeniusPower)} need not agree.  However, they will agree when $I$ is a principal ideal.

%R = ZZ/3[x,y];
%M = ideal(x, y);
%nu(3, M^5)
%nu(3, M^5, ContainmentTest => FrobeniusPower)

The function {\tt nu} works by searching through the list of potential integers $n$ and checking containments of $I^n$ in a specified Frobenius power of $J$.  The way this search is approached is specified by the option {\tt Search}, which can be set to {\tt Binary} (the default value) or {\tt Linear}.

%R = ZZ/5[x,y,z];
%f = x^2*y^4 + y^2*z^7 + z^2*x^8;
%time nu(5, f) -- uses binary search (default)
%time nu(5, f, Search => Linear)
%M = ideal(x, y, z);
%time nu(2, M, M^2) -- uses binary search (default)
%time nu(2, M, M^2, Search => Linear) -- but linear seach gets luckier

The option {\tt ReturnList} (default value {\tt false}) can be used to request that the output be not only $\nu_I^J(p^e)$, but a list contaning $\nu_I^J(p^i)$, for $i=0,\ldots,e$.

%nu(5, f, ReturnList => true)

Alternatively, the option {\tt Verbose} (default value {\tt false}) can be used to request that the values $\nu_I^J(p^i)$ ($i=0,\ldots,e$) be printed as they are computed, to monitor the progress of the computation.

%nu(5, f, Verbose => true)

%%Below is the original version of the section describing the nu function

%\section{The $F$-pure threshold limit and {\tt nu}}
%\label{sec.Nu}
%
%Suppose $R = k[x_1, \dots, x_n]$ is a polynomial ring over a finite field and $f \in R$.    If $f^a \notin \langle x_1^{p^e}, \dots, x_n^{p^e} \rangle = \fram^{[p^e]}$, then the pair $(R, f^{a/(p^e -1)})$ is $F$-pure at the origin, whereas if $f^a \in \fram^{[p^e]}$, then the pair $(R, f^{a/p^e})$ is not $F$-pure at the origin.  By finding the $a \in \bZ$ where that transition happens, and then limiting over $e$, one can compute the $F$-pure threshold.  See \cite{MustataTakagiWatanabeFThresholdsAndBernsteinSato}.
%
%We set $\nu(e, f)$ to be largest $a \in \bZ$ such that $f^a \notin \fram^{[p^e]}$ (note in the literature, it is frequently denoted by $\nu_f(p^e)$.  It immediately follows that
%\[
%\fpt(f) = \lim_{e \to \infty} {\nu(e, f) \over p^e}.
%\]
%These numbers $\nu(e, f)$ can be computed using the command {\tt nu}, as in the example below.
%\medskip
%{\small
%\setstretch{.67}
%\begin{MyVerbatim}
%i1 : loadPackage "FThresholds"
%
%o1 = FThresholds
%
%o1 : Package
%
%i2 : R = ZZ/7[x,y]
%
%o2 = R
%
%o2 : PolynomialRing
%
%i3 : f = y^2 - x^3
%
%        3    2
%o3 = - x  + y
%
%o3 : R
%
%i4 : nu(1, f)
%
%o4 = 5
%
%o4 : QQ
%
%i5 : nu(2, f)
%
%o5 = 40
%
%o5 : QQ
%
%i6 : nu(3, f)
%
%o6 = 285
%
%o6 : QQ
%\end{MyVerbatim}
%}
%\medskip
%The numbers $5/7, 40/49, 285/343$ then approximate the $F$-pure threshold, which in this case happens to equal $5/6$.  By default, if the function $f$ has a special form (is a diagonal polynomial or a binomial), then the function does not check whether $f^a$ is in  $\langle x_1^{p^e}, \dots, x_n^{p^e} \rangle$, but instead uses general formulas for $\nu$s, see \cite{HernandezFPureThresholdOfBinomial,HernandezFInvariantsOfDiagonalHyp}.
%
%In fact, one can make the following more general definition.  If $I$ and $J$ are two ideals (with $I \subseteq \sqrt{J}$), one can define
%\[
%\nu(e, I, J) = \max \{ n \in \bZ \; |\; I^n \not\subseteq J^{[p^e]} \}.
%\]
%This is frequently denoted by $\nu_I^J(p^e)$ in the literature.  In the case that $I = \langle f \rangle$ and $J = \fram$, this just recovers the $\nu$'s defined above; the limit of which is the $F$-pure threshold.  For more general $I$ and $J$, the limit
%\[
%\lim_{e \to \infty} {\nu(e, I, J) \over p^e}
%\]
%is called the \emph{$F$-threshold of $I$ with respect to $J$}.  To compute these values we use a binary search, unless the user specifies that we should use a linear search instead {\tt Search=>Linear}.
%
%There is one more option that deserves mentioning, {\tt ContainmentTest}.  There are two ways to check whether $f^a$ (or $I^a$) is contained in $J^{[p^e]}$.  In general it is true that
%\[
%I^a \subseteq J^{[p^e]} \text{ $\Leftrightarrow$ } (I^a)^{[1/p^e]} \subseteq J
%\]
%where $\bullet^{[1/p^e]}$ is defined as in the {\tt TestIdeals} package.  Which of these two strategies to use is controlled by the option {\tt ContainmentTest => StandardPower} and {\tt ContainmentTest => FrobeniusRoot} respectively.
%For principal $I$, the command on the right is generally faster (and so {\tt FrobeniusRoot} is the default strategy for computing $\nu$).  For non-principal $I$, frequently the command on the left is quicker, and so {\tt StandardPower} is default strategy.
%
%Finally, the option {\tt ContainmentTest => FrobeniusPower}, then ${\tt \nu(e, I, A)}$ computes the largest integer $n$ such that
%\[
%I^{[p^n]} \subseteq J^{[p^e]}.
%\]
%See \cite{HernandezTeixeiraWittFrobeniusPowers} for more discussion of this.

\section{{\tt isFPT}, {\tt compareFPT} and {\tt isFJumpingExponent}}
\label{sec.IsFPT}

The \emph{FrobeniusThresholds} package contains methods to 
 test candidate values for an $F$-pure threshold, and even $F$-jumping numbers, even in some singular rings.  
Consider a  $\mathbb{Q}$-Gorenstein ring $R$ of characteristic $p>0$, whose index not divisible by $p$.
Given a rational number $t$ and an element $f$ of $R$, the command {\tt isFPT(t,f)} outputs {\tt true} if $t$ is the $F$-pure threshold of $f$, and {\tt false} otherwise. 
Moreover, the function {\tt compareFPT} provides further information about the relationship between $t$ and the $F$-pure threshold of $f$; namely, 
{\tt compareFPT(t, f)} returns {\tt-1} when $t < \fpt(f)$, {\tt 0} when $t = \fpt(f)$ and {\tt 1} when $t > \fpt(f)$.
Setting the option {\tt IsLocal} to {\tt true} tells the function to consider the $F$-pure threshold at the origin.
The following example illustrates this functionality. 

{\small
\setstretch{.67}
\begin{MyVerbatim}

i1 : R = ZZ/11[x, y, z]/( x^2 - y*( z - 1 ) );

i2 : compareFPT( 5/11, z - 1 )

o2 = -1

i3 : isFPT( 1/2, z - 1 )

o3 = true

i4 : isFPT( 1/2, z - 1, IsLocal => true )

o4 : false

\end{MyVerbatim}
}

The general method applied calls upon functionality from the \emph{TestIdeals} package \cite{TestIdealsPackage, TestIdealsPaper}.  The functions {\tt testIdeal} and {\tt FPureModule} therein are used
to compute the test ideals of $f$ with respect to the parameter $t$, and that with respect to $t - \varepsilon$, for $\varepsilon>0$ very small. For instance, as noted in the introduction, when $R$ is a polynomial ring, $t$ is the $F$-pure threshold of $f$ if and only if $\tau(R, f^t)$ is contained in the homogeneous maximal ideal, but 
$\tau(R, f^{t-\varepsilon})$ is not. 
(Note that for $R$ strongly $F$-regular and Gorenstein, {\tt FPureModule(t, f)} precisely computes $\tau(R, f^{t-\varepsilon})$.)  
%These commands work more generally, but they \emph{only} currently work when $R$ is $\bQ$-Gorenstein, with index not divisible by $p$.

Since not only the $F$-pure thresholds, but also the higher $F$-jumping numbers, are determined by containment conditions on test ideals, the functionality is extended to determine whether a given number is an $F$-jumping number.
Analogous syntax is used, as shown in the following example. 

{\small
\setstretch{.67}
\begin{MyVerbatim}

i49 : R = ZZ/13[x, y];

i50 : f = y*( ( y + 1 ) - ( x - 1 )^2 )*( x - 2 )*( x + y - 2 );

i51 : isFJumpingExponent( 3/4, f )

o51 = true

\end{MyVerbatim}
}




\newpage
\section{The {\tt fpt} function}
\label{sec.FPT}

The core function in this package is the {\tt fpt} function.  Throughout this section, let $f$ be a polynomial with coefficients in a finite field of characteristic $p$. When passed the polynomial $f$, the function {\tt fpt} attempts to find the exact value for the $F$-pure threshold of $f$ at the origin, and returns that value, if possible.  Otherwise, it returns lower and upper bounds for the $F$-pure threshold, as demonstrated below.

{\small
\setstretch{.67}
\begin{MyVerbatim}

i1 : ZZ/5[x,y,z];

i2 : fpt( x^3 + y^3 + z^3 + x*y*z )

     4
o2 = -
     5

o2 : QQ

i3 : fpt( x^5 + y^6 + z^7 + (x*y*z)^3 )

      1  2
o3 = {-, -}
      3  5

o3 : List

\end{MyVerbatim}
}

             If the option {\tt UseSpecialAlgorithms} is set to {\tt true} (the default value), then {\tt fpt} first checks whether $f$ is a diagonal polynomial, a binomial, or a form in two variables, in that order.
             If it is one of these, algorithms of Hern\'andez \cite{HernandezFInvariantsOfDiagonalHyp, HernandezFPureThresholdOfBinomial}, or Hern\'andez and Teixeira \cite{HernandezTeixeiraFThresholdFunctions},  are executed to compute the $F$-pure threshold (cf. \cite{ShibutaTakagiLCThresholds}).

{\small
\setstretch{.67}
\begin{MyVerbatim}

i4 : fpt( x^17 + y^20 + z^24 ) -- a diagonal polynomial

      94
o4 = ---
     625

i5 : fpt( x^2*y^6*z^10 + x^10*y^5*z^3 ) -- a binomial

      997
o5 = ----
     6250

o5 : QQ

i6 : ZZ/5[x,y];

i7 : fpt( x^2*y^6*(x + y)^9*(x + 3*y)^10 ) -- a form in two variables

      5787
o7 = -----
     78125

o7 : QQ

\end{MyVerbatim}
}

            The above noted algorithm for computing the $F$-pure threshold of a binary form $f$ requires factoring $f$ into linear forms, and {\tt fpt} can sometimes hang when attempting that factorization. For this reason, when a factorization is already known, the user can pass to {\tt fpt} a list containing all the pairwise prime linear factors of $f$, and a list containing their respective multiplicities.

{\small
\setstretch{.67}
\begin{MyVerbatim}

i8 : L = {x, y, x + y, x + 3*y};

i9 : m = {2, 6, 9, 10};

i10 : fpt(L, m)==o7

o10 = true

\end{MyVerbatim}
}

In the remainder of this section, we describe the {\tt fpt} function when no special algorithm is available, or {\tt UseSpecialAlgorithms} is set to {\tt false},  as well as the roles of the options {\tt DepthOfSearch}, and {\tt Attempts}, both nonnegative integers.

In this case, very roughly speaking, the {\tt fpt} function will either compute, and output, the exact value of the $F$-pure threshold of $f$, and otherwise recursively compute a finite sequence of lower and upper bounds for this value, and output the last of these, which will be the tightest among all computed.  The value of the option {\tt DepthOfSearch} determines the precision of the initial set of bounds, and the option {\tt Attempts}, in conjunction with some various subroutines, determines whether, and how, to produce new, tighter bounds from the previous ones.

In more detail, let $e$ denote the value of the option {\tt DepthOfSearch}, which conservatively defaults to {\tt 1}.  The {\tt fpt} function first computes $\nu=\nu_f(p^e)$, which agrees with the output of {\tt nu(e,f)}.  It is well known that the $F$-pure threshold of $f$ is greater than $\nu/p^e$ and at most $(\nu+1)/p^e$, and applying  \cite[Proposition 4.2]{HernandezFPurityOfHypersurfaces} to this lower bound tells us that the $F$-pure threshold of $f$ must be at least $\nu/(p^e-1)$.  In summary, we know that the $F$-pure threshold of $f$ must lie in the closed interval
%
\begin{equation}
\label{estimating-interval: e}
\tag{$\dagger$}
\left[ \frac{\nu}{p^e-1}, \frac{\nu+1}{p^e} \right].
\end{equation}

With these estimates in hand, the subroutine {\tt guessFPT} is called to make some ``educated guesses" in an attempt to identify the $F$-pure threshold within this interval, or at least narrow down this interval to produce improved estimates.  The number of ``guesses" is controlled by the option {\tt Attempts}, which conservatively defaults to {\tt 3}.  If {\tt Attempts} is set to {\tt 0}, then {\tt guessFPT} is bypassed. If  {\tt Attempts} is set to at least {\tt 1}, then a first check is run to verify whether the right-hand endpoint $(\nu+1)/p^e$ of the above interval \eqref{estimating-interval: e} is the $F$-pure threshold.  We illustrate this below.

{\small
\setstretch{.67}
\begin{MyVerbatim}

i11 : f = x^2*(x + y)^3*(x + 3*y^2)^5;

i12 : fpt( f, Attempts => 0 ) -- a bad estimate

          1
o12 = {0, -}
          5

o12 : List

i13 : fpt( f, Attempts => 0, DepthOfSearch => 3 ) -- a better estimate

        21   22
o13 = {---, ---}
       124  125

o13 : List

i14 : fpt( f, Attempts => 1, DepthOfSearch => 3 ) -- the right-hand

      endpoint (nu+1)/p^e is the F-pure threshold

       22
o14 = ---
      125

o14 : QQ

\end{MyVerbatim}
}

If  {\tt Attempts} is set to at least {\tt 2} and the right-hand endpoint $(\nu+1)/p^e$ of the interval \eqref{estimating-interval: e} is not the $F$-pure threshold, then a second check is run to verify whether the left-hand endpoint $\nu/(p^e-1)$ of this interval is the $F$-pure threshold.

{\small
\setstretch{.67}
\begin{MyVerbatim}

i15 : f = x^6*y^4 + x^4*y^9 + (x^2 + y^3)^3;

i16 : fpt( f, Attempts => 1, DepthOfSearch => 3 )

       17   7
o16 = {--, --}
       62  25

o16 : List

i17 : fpt( f, Attempts => 2, DepthOfSearch => 3 ) -- the left-hand endpoint

      nu/(p^e-1) is the F-pure threshold

      17
o17 = --
      62

o17 : QQ

\end{MyVerbatim}
}

            If neither endpoint is the $F$-pure threshold and {\tt Attempts} is set to more than {\tt 2}, then  additional checks are performed at certain numbers within the interval, chosen according to the criteria determined by the value of the option {\tt GuessStrategy}.  We refer the reader for the documentation of this strategy for more details.

{\color{red}  This will need to be updated.  Maybe look at Pedro's new documentation.}            
            
{\small
\setstretch{.67}
\begin{MyVerbatim}

i18 : f = x^3*y^11*(x + y)^8*(x^2 + y^3)^8;

i19 : fpt( f, DepthOfSearch => 3, Attempts => 2 )

        3   7
o19 = {--, ---}
       62  125

o19 : List

i20 : fpt( f, DepthOfSearch => 3, Attempts => 3 ) -- an additional check

      sharpens the estimate

        3   1
o20 = {--, --}
       62  18

o20 : List

i21 : fpt( f, DepthOfSearch => 3, Attempts => 4 ) -- and one more finds

      the answer

       1
o21 = --
      19

o21 : QQ

\end{MyVerbatim}
}


If {\tt guessFPT} is unsuccessful and {\tt UseFSignature} is set to {\tt true}, then the {\tt fpt} function proceeds to use the convexity of the $F$-signature function and a secant line argument to attempt to narrow down the interval bounding the $F$-pure threshold.

{\small
\setstretch{.67}
\begin{MyVerbatim}

i22 : f = x^5*y^6*(x + y)^9*(x^2 + y^3)^4;

i23 : fpt( f, DepthOfSearch => 3 )

        2   1
o23 = {--, --}
       31  14

o23 : List

i24 : fpt( f, DepthOfSearch => 3, UseFSignature => true )

        181   1
o24 = {----, --}
       2750  14

o24 : List

i25 : numeric o23

o25 = {.0645161, .0714286}

o25 : List

i26 : numeric o24 -- UseFSignature sharpened the estimate a bit

o26 = {.0658182, .0714286}

o26 : List

\end{MyVerbatim}
}

When {\tt FRegularityCheck} is set to {\tt true} and no exact answer has been found, a final check is run to verify whether the final lower bound for the $F$-pure threshold is the exact answer (if it has not already been eliminated as a possibility).

{\small
\setstretch{.67}
\begin{MyVerbatim}

i27 : f = (x + y)^4*(x^2 + y^3)^6;

i28 : fpt( f, Attempts => 2, DepthOfSearch => 3 )

        3   13
o28 = {--, ---}
       31  125

o28 : List

i29 : fpt( f, Attempts => 2, DepthOfSearch => 3, UseFSignature => true ) --

      UseFSignature improves the answer a bit

        1   13
o29 = {--, ---}
       10  125

o29 : List

i30 : fpt( f, Attempts => 2, DepthOfSearch => 3, UseFSignature => true,

      FRegularityCheck => true ) -- FRegularityCheck finds the answer

       1
o30 = --
      10

o30 : QQ

\end{MyVerbatim}
}

The computations performed when {\tt UseFSignature} and {\tt FRegularityCheck} are set to {\tt true} are often slow, and often fail to improve the estimate, and for this reason, these options should be used sparingly.
            It is often more effective to increase the values of {\tt Attempts} or {\tt DepthOfSearch} instead.

{\small
\setstretch{.67}
\begin{MyVerbatim}

i31 : f = x^7*y^5*(x + y)^5*(x^2 + y^3)^4;

i32 : timing numeric fpt( f, DepthOfSearch => 3, UseFSignature => true,

      FRegularityCheck => true )

o32 = {.0733061, .0769231}
      -- 2.68899 seconds

o32 : Time

i33 : timing numeric fpt( f, Attempts => 5, DepthOfSearch => 3 ) -- a better

      answer in less time

o33 = {.075, .0769231}
      -- .893389 seconds

o33 : Time

i34 : timing fpt( f, DepthOfSearch => 4 ) -- the exact answer in even less
      time

       48
o34 = ---
      625
      -- .361882 seconds

o34 : Time

\end{MyVerbatim}
}

As seen in several examples above, when the exact  $F$-pure threshold of $f$ is not found, a list containing the endpoints of an interval containing its value is returned.  Whether that interval is open, closed, or a mixed interval depends on the options passed; if the option {\tt Verbose} is set to {\tt true}, the precise interval will be printed.

{\small
\setstretch{.67}
\begin{MyVerbatim}

i35 : f = x^7*y^5*(x + y)^5*(x^2 + y^3)^4;

i36 : fpt( f, DepthOfSearch => 3, UseFSignature => true, Verbose => true )

Starting fpt ...

fpt is not 1 ...

Verifying if special algorithms apply...

Special fpt algorithms were not used ...

nu has been computed: nu = nu(3,f) = 9 ...

fpt lies in the interval [ nu/(p^e-1), (nu+1)/p^e ] = [ 9/124, 2/25 ] ...

Starting guessFPT ...

The right-hand endpoint is not the fpt ...

The left-hand endpoint is not the fpt ...

guessFPT narrowed the interval down to ( 9/124, 1/13 ) ...

Beginning F-signature computation ...

First F-signature computed: s(f,(nu-1)/p^e) = 456/15625 ...

Second F-signature computed: s(f,nu/p^e) = 64/15625 ...

Computed F-signature secant line intercept: 449/6125 ...

F-signature intercept is an improved lower bound ...

fpt failed to find the exact answer; try increasing the value of

DepthOfSearch or Attempts.

fpt lies in the interval [ 449/6125, 1/13 ).

        449   1
o36 = {----, --}
       6125  13

o36 : List

\end{MyVerbatim}
}

\newpage
\bibliographystyle{skalpha}
\bibliography{MainBib}



\end{document}
